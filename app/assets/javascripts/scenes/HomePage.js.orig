Scene.HomePage = function(game) {
<<<<<<< HEAD
this.hunger = 0
=======
>>>>>>> master
};

Scene.HomePage.prototype = {

	create: function() {
<<<<<<< HEAD


		this.clouds = this.game.add.tileSprite(0, 0, 640, 138, 'clouds');
		this.land = this.game.add.tileSprite(0, 138, 640, 1020, 'land')
=======
    this.forest = this.game.add.tileSprite(0,0, 450,800, 'forest');
>>>>>>> master

    this.poops = this.game.add.group()

    this.green_dragon = this.game.add.sprite(this.game.world.centerX, this.game.world.centerY+200, 'green_dragon')
    this.green_dragon.anchor.set(0.5)

    this.game.physics.enable(this.green_dragon, Phaser.Physics.arcade)
    this.green_dragon.body.collideWorldBounds = true
    this.restMotion()

    this.green_dragon.animations.add('rest', [0, 1, 2, 3, 4, 5, 6, 7], 6, true)
    this.green_dragon.animations.add('walk', [16, 17, 18, 19, 20, 21], 6, true)
    this.green_dragon.animations.add('eat', [12, 13, 14, 15], 4, true)
    this.green_dragon.animations.add('poke', [22, 23, 24], 3, true)

    this.green_dragon.inputEnabled=true
    this.green_dragon.input.useHandCursor=true
    this.green_dragon.events.onInputDown.add(this.dragonPoke.bind(this))

    this.platforms = this.game.add.group()
    this.platforms.enableBody = true
    this.ground = this.platforms.create(0, this.game.world.height-145)
    this.ground.scale.setTo(800,1)
    this.ground.body.immovable = true
    this.ground.visibility = false

    this.food_button = this.game.add.sprite(30,676, "food_button")
    this.food_button.inputEnabled = true;
    this.food_button.events.onInputDown.add(this.dropFood.bind(this), this)
    this.exercise_button = this.game.add.sprite(240,676, "exercise_button")
    this.exercise_button.inputEnabled = true
    this.exercise_button.events.onInputDown.add(this.goExercise.bind(this), this)

    this.exercise_button = this.game.add.sprite(30,10, "exercise_button")
    this.exercise_button.inputEnabled = true
    this.exercise_button.events.onInputDown.add(this.goSmash.bind(this), this)


    this.poopCount = this.game.add.text(10, 200, "Poops: " + this.poops.countLiving(), {fill: 'white', font: 'bold 20pt Arial'});

  },

  goSmash: function(){
    this.clearAllTimeouts()
    this.game.state.start('BugGame')

  },

  update: function() {

    this.game.physics.arcade.overlap(this.green_dragon, this.foods, this.eatFood.bind(this), null, this)
    this.game.physics.arcade.collide(this.ground, this.foods, this.collision.bind(this), null, this)
<<<<<<< HEAD

    this.clouds.tilePosition.x += 1;
    this.poopCount.text = "Poops: " + this.poops.countLiving()
=======
>>>>>>> master
  },
  dragonPoke: function() {
    if (this.game.input.activePointer.isDown)
      this.green_dragon.animations.play('poke')
  },
  restMotion: function() {
    this.green_dragon.animations.play('rest')
    this.walkAroundDelay = setTimeout(this.walkAround.bind(this), 2000)
  },
  walkAround: function() {
    var amountMoved = Math.floor(Math.random()*(200))
    if (amountMoved > 50)
      setTimeout(this.poop(this.green_dragon.position.x, this.green_dragon.position.y), 1000)
    if (amountMoved%2==0)
      this.walkLeft(amountMoved)
    else
      this.walkRight(amountMoved)
  },
  walkLeft: function(amountMoved) {
    if (this.green_dragon.scale.x < 0) {
      this.green_dragon.scale.x *= -1
    }
    this.green_dragon.animations.play('walk')
    var leftWalk = this.game.add.tween(this.green_dragon)
    leftWalk.to({x: this.green_dragon.position.x-amountMoved}, 2000)
    leftWalk.start()
    this.leftRestDelay = setTimeout(this.restMotion.bind(this), 2000)
  },
  walkRight: function(amountMoved) {
    if (this.green_dragon.scale.x > 0) {
      this.green_dragon.scale.x *= -1
    }
    this.green_dragon.animations.play('walk')
    var leftWalk = this.game.add.tween(this.green_dragon)
    leftWalk.to({x: this.green_dragon.position.x+amountMoved}, 2000)
    leftWalk.start()
    // setTimeout(function(){this.green_dragon.scale.x *= -1}, 2000)
    this.rightRestDelay = setTimeout(this.restMotion.bind(this), 2000)
  },
  dropFood: function(){

    this.foods = this.game.add.group()
    this.foods.createMultiple(1, 'food')
    if (this.foods.getFirstDead()){
    this.food = this.foods.getFirstDead()
    this.game.physics.enable(this.food, Phaser.Physics.arcade)
    // this.food.reset(Math.floor(Math.random()*420),0 )
    this.food.reset(this.green_dragon.position.x, 0)
    this.food.body.gravity.y = 800


    }
  },
  clearAllTimeouts: function(){
    clearTimeout(this.rightRestDelay)
    clearTimeout(this.leftRestDelay)
    clearTimeout(this.walkAroundDelay)
    clearTimeout(this.eatRestDelay)

  },
  eatFood: function(){
    this.food.kill()
    this.green_dragon.animations.play('eat')
    this.clearAllTimeouts()
    this.eatRestDelay = setTimeout(this.restMotion.bind(this), 2000)

  },
  collision: function(){
    this.food.body.gravity.y = 0
    this.food.body.velocity.y = 0
  },
  goExercise: function(){
    this.clearAllTimeouts()
    this.game.state.start('Stomper')
  },

  poop: function(xc, yc) {
    this.poopie = this.game.add.sprite(xc, yc+40, 'poop')
    this.poopie.position.z = -10
    // this.poopie.scale.x *= 0.1
    // this.poopie.scale.y *= 0.1
    this.poopie.anchor.set(0.5)
    this.poopie.inputEnabled=true
    this.poopie.input.useHandCursor=true
    this.poopie.events.onInputDown.add(this.cleanPoop.bind(this))
    this.poops.add(this.poopie)


  },
  cleanPoop: function() {
    if (this.game.input.activePointer.isDown)
      this.poops.removeAll()
  }
};
